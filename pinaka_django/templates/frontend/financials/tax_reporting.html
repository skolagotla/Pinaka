{% extends 'frontend/base.html' %}

{% block title %}Tax Reporting - Pinaka{% endblock %}

{% block content %}
<div class="px-4 sm:px-6 lg:px-8">
    <div class="sm:flex sm:items-center mb-8">
        <div class="sm:flex-auto">
            <h1 class="text-3xl font-bold text-gray-900">Tax Reporting (T776)</h1>
            <p class="mt-2 text-sm text-gray-600">Generate T776 tax forms for Canadian landlords</p>
        </div>
        <div class="mt-4 sm:mt-0 sm:ml-16 sm:flex-none">
            <form method="get" class="flex items-center space-x-4">
                <label class="text-sm font-medium text-gray-700">Year:</label>
                <select name="year" onchange="this.form.submit()" class="rounded-md border-gray-300 shadow-sm">
                    {% for y in years %}
                    <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}</option>
                    {% endfor %}
                </select>
                <button type="button" onclick="window.print()" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                    <i class="fas fa-print mr-2"></i>Print
                </button>
            </form>
        </div>
    </div>

    <!-- Summary -->
    <div class="grid grid-cols-1 gap-5 sm:grid-cols-3 mb-8">
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="text-2xl font-bold text-green-600">${{ total_rent|floatformat:2 }}</div>
                <div class="text-sm text-gray-500">Total Rent Income</div>
            </div>
        </div>
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="text-2xl font-bold text-red-600">${{ total_expenses|floatformat:2 }}</div>
                <div class="text-sm text-gray-500">Total Expenses</div>
            </div>
        </div>
        <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="text-2xl font-bold text-blue-600">${{ total_net_income|floatformat:2 }}</div>
                <div class="text-sm text-gray-500">Net Income</div>
            </div>
        </div>
    </div>

    <!-- Property Breakdown -->
    <div class="bg-white shadow rounded-lg">
        <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Property Breakdown - {{ year }}</h3>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Property</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rent Income</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Expenses</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Net Income</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for data in tax_data %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ data.property.property_name }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-green-600">${{ data.rent_income|floatformat:2 }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-red-600">${{ data.expenses|floatformat:2 }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-blue-600">${{ data.net_income|floatformat:2 }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="px-6 py-12 text-center text-gray-500">No property data for {{ year }}</td>
                    </tr>
                    {% endfor %}
                    <tr class="bg-gray-50 font-semibold">
                        <td class="px-6 py-4 whitespace-nowrap text-sm">Total</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-green-600">${{ total_rent|floatformat:2 }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-red-600">${{ total_expenses|floatformat:2 }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600">${{ total_net_income|floatformat:2 }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- T776 Form Information -->
    <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6">
        <h3 class="text-lg font-semibold text-blue-900 mb-2">T776 Form Information</h3>
        <p class="text-sm text-blue-800">
            This report provides the information needed to complete your T776 Statement of Real Estate Rentals form for the Canada Revenue Agency (CRA).
            Use the totals above to fill in the appropriate sections of your T776 form.
        </p>
    </div>
</div>
{% endblock %}

