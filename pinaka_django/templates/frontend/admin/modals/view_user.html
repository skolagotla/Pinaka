<!-- View User Modal -->
<div id="view-user-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="p-6 border-b border-gray-200">
            <div class="flex justify-between items-center">
                <h3 class="text-xl font-semibold text-gray-900">User Details</h3>
                <button onclick="closeViewUserModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <div class="p-6" id="view-user-content">
            <div class="text-center py-8">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                <p class="mt-2 text-gray-500">Loading user details...</p>
            </div>
        </div>
        
        <div class="p-6 border-t border-gray-200 flex justify-end">
            <button onclick="closeViewUserModal()" 
                    class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg">
                Close
            </button>
        </div>
    </div>
</div>

<script>
function viewUser(userId, userRole) {
    document.getElementById('view-user-modal').classList.remove('hidden');
    const content = document.getElementById('view-user-content');
    content.innerHTML = '<div class="text-center py-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div><p class="mt-2 text-gray-500">Loading user details...</p></div>';
    
    fetch(`/admin/api/users/${userId}/${userRole}/`)
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                const user = data.data;
                let html = '<div class="space-y-4">';
                
                if (user.role === 'pmc') {
                    html += `
                        <div><strong class="text-gray-700">Company Name:</strong> <span class="ml-2">${user.companyName || '—'}</span></div>
                    `;
                } else {
                    html += `
                        <div><strong class="text-gray-700">Name:</strong> <span class="ml-2">${user.firstName || ''} ${user.lastName || ''}</span></div>
                    `;
                }
                
                html += `
                    <div><strong class="text-gray-700">Email:</strong> <span class="ml-2">${user.email}</span></div>
                    <div><strong class="text-gray-700">Phone:</strong> <span class="ml-2">${user.phone || '—'}</span></div>
                    <div><strong class="text-gray-700">Role:</strong> <span class="ml-2 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded">${user.role.toUpperCase()}</span></div>
                    <div><strong class="text-gray-700">Status:</strong> <span class="ml-2 px-2 py-1 text-xs bg-${user.status === 'active' ? 'green' : user.status === 'pending' ? 'yellow' : 'gray'}-100 text-${user.status === 'active' ? 'green' : user.status === 'pending' ? 'yellow' : 'gray'}-800 rounded">${user.status.toUpperCase()}</span></div>
                `;
                
                if (user.rbacRoles && user.rbacRoles.length > 0) {
                    html += '<div><strong class="text-gray-700">RBAC Roles:</strong><div class="ml-2 mt-2 space-y-1">';
                    user.rbacRoles.forEach(role => {
                        html += `<span class="px-2 py-1 text-xs bg-purple-100 text-purple-800 rounded mr-2">${role.role.displayName || role.role.name}</span>`;
                    });
                    html += '</div></div>';
                }
                
                html += '</div>';
                content.innerHTML = html;
            } else {
                content.innerHTML = '<div class="text-center py-8 text-red-500">Failed to load user details</div>';
            }
        })
        .catch(err => {
            content.innerHTML = '<div class="text-center py-8 text-red-500">Error loading user details</div>';
        });
}

function closeViewUserModal() {
    document.getElementById('view-user-modal').classList.add('hidden');
}
</script>

