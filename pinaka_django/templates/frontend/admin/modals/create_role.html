<!-- Create/Edit Role Modal -->
<div id="role-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4">
        <div class="p-6 border-b border-gray-200">
            <div class="flex justify-between items-center">
                <h3 class="text-xl font-semibold text-gray-900" id="role-modal-title">Create Role</h3>
                <button onclick="closeRoleModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <form id="role-form" class="p-6">
            <div id="role-result" class="mb-4"></div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Role Name</label>
                <input type="text" name="name" id="role-name" 
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                       placeholder="SUPER_ADMIN" required>
                <p class="text-xs text-gray-500 mt-1">Use uppercase with underscores (e.g., SUPER_ADMIN)</p>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Display Name</label>
                <input type="text" name="displayName" id="role-display-name" 
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                       placeholder="Super Admin" required>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                <textarea name="description" id="role-description" rows="3" 
                          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                          placeholder="Role description..."></textarea>
            </div>
            
            <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
                <button type="button" onclick="closeRoleModal()" 
                        class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg">
                    Cancel
                </button>
                <button type="submit" 
                        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
                    <span id="role-submit-text">Create Role</span>
                </button>
            </div>
        </form>
    </div>
</div>

<script>
let currentRoleId = null;

function createRole() {
    currentRoleId = null;
    document.getElementById('role-modal-title').textContent = 'Create Role';
    document.getElementById('role-submit-text').textContent = 'Create Role';
    document.getElementById('role-form').reset();
    document.getElementById('role-result').innerHTML = '';
    document.getElementById('role-modal').classList.remove('hidden');
}

function editRole(roleId) {
    currentRoleId = roleId;
    document.getElementById('role-modal-title').textContent = 'Edit Role';
    document.getElementById('role-submit-text').textContent = 'Update Role';
    document.getElementById('role-result').innerHTML = '';
    document.getElementById('role-modal').classList.remove('hidden');
    
    // Load role data
    fetch(`/admin/api/roles/`)
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                const role = data.data.find(r => r.id === roleId);
                if (role) {
                    document.getElementById('role-name').value = role.name;
                    document.getElementById('role-display-name').value = role.displayName;
                    document.getElementById('role-description').value = role.description || '';
                }
            }
        });
}

function closeRoleModal() {
    document.getElementById('role-modal').classList.add('hidden');
    document.getElementById('role-form').reset();
    currentRoleId = null;
}

document.getElementById('role-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    const data = {
        name: formData.get('name'),
        displayName: formData.get('displayName'),
        description: formData.get('description'),
    };
    
    const url = currentRoleId 
        ? `/admin/api/roles/${currentRoleId}/`
        : '/admin/api/roles/create/';
    const method = currentRoleId ? 'PATCH' : 'POST';
    
    fetch(url, {
        method: method,
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            showToast(currentRoleId ? 'Role updated successfully!' : 'Role created successfully!', 'success');
            closeRoleModal();
            setTimeout(() => location.reload(), 1000);
        } else {
            showToast(data.error || 'Failed to save role', 'error');
        }
    });
});
</script>

