{% extends 'frontend/admin/base.html' %}

{% block title %}Settings - Pinaka{% endblock %}

{% block content %}
<div class="p-6">
    <!-- Page Header -->
    <div class="mb-6">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Settings</h1>
        <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">Manage your account preferences and appearance</p>
    </div>

    <!-- Settings Tabs -->
    <div class="bg-white rounded-lg shadow">
        <div class="flex">
            <!-- Left Sidebar Tabs -->
            <div class="w-64 bg-gray-50 border-r border-gray-200 p-4">
                <nav class="space-y-1">
                    <a href="#profile" onclick="showTab('profile'); return false;" 
                       class="tab-link active flex items-center px-4 py-3 text-sm font-medium rounded-lg">
                        <i class="fas fa-user w-5 mr-3"></i>
                        Profile
                    </a>
                    <a href="#signature" onclick="showTab('signature'); return false;" 
                       class="tab-link flex items-center px-4 py-3 text-sm font-medium rounded-lg">
                        <i class="fas fa-pen-fancy w-5 mr-3"></i>
                        Signature
                    </a>
                    <a href="#appearance" onclick="showTab('appearance'); return false;" 
                       class="tab-link flex items-center px-4 py-3 text-sm font-medium rounded-lg">
                        <i class="fas fa-palette w-5 mr-3"></i>
                        Appearance
                    </a>
                </nav>
            </div>

            <!-- Tab Content -->
            <div class="flex-1 p-6">
                <!-- Profile Tab -->
                <div id="tab-profile" class="tab-content">
                    <h2 class="text-2xl font-semibold mb-6">Profile Information</h2>
                    <form method="post" action="{% url 'admin_user_settings' %}" id="profileForm" class="space-y-6">
                        {% csrf_token %}
                        <input type="hidden" name="tab" value="profile">
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">First Name *</label>
                                <input type="text" name="first_name" value="{{ user_data.first_name|default:'' }}" required
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Middle Name</label>
                                <input type="text" name="middle_name" value="{{ user_data.middle_name|default:'' }}"
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Last Name *</label>
                                <input type="text" name="last_name" value="{{ user_data.last_name|default:'' }}" required
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                <input type="email" name="email" value="{{ user_data.email|default:'' }}" disabled
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Phone *</label>
                                <input type="tel" name="phone" value="{{ user_data.phone|default:'' }}" required
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                       placeholder="(XXX) XXX-XXXX">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Country</label>
                                <select name="country" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="CA" {% if user_data.country == 'CA' or not user_data.country %}selected{% endif %}>Canada</option>
                                    <option value="US" {% if user_data.country == 'US' %}selected{% endif %}>United States</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Address Line 1 *</label>
                                <input type="text" name="address_line1" value="{{ user_data.address_line1|default:'' }}" required
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">City *</label>
                                <input type="text" name="city" value="{{ user_data.city|default:'' }}" required
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    {% if user_data.country == 'US' or not user_data.country %}State{% else %}Province{% endif %} *
                                </label>
                                <input type="text" name="province_state" value="{{ user_data.province_state|default:'' }}" required
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    {% if user_data.country == 'US' or not user_data.country %}ZIP Code{% else %}Postal Code{% endif %} *
                                </label>
                                <input type="text" name="postal_zip" value="{{ user_data.postal_zip|default:'' }}" required
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                                <select name="timezone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="America/Toronto" {% if user_data.timezone == 'America/Toronto' or not user_data.timezone %}selected{% endif %}>Eastern Time (America/Toronto)</option>
                                    <option value="America/Vancouver" {% if user_data.timezone == 'America/Vancouver' %}selected{% endif %}>Pacific Time (America/Vancouver)</option>
                                    <option value="America/New_York" {% if user_data.timezone == 'America/New_York' %}selected{% endif %}>Eastern Time (America/New_York)</option>
                                    <option value="America/Chicago" {% if user_data.timezone == 'America/Chicago' %}selected{% endif %}>Central Time (America/Chicago)</option>
                                    <option value="America/Denver" {% if user_data.timezone == 'America/Denver' %}selected{% endif %}>Mountain Time (America/Denver)</option>
                                    <option value="America/Los_Angeles" {% if user_data.timezone == 'America/Los_Angeles' %}selected{% endif %}>Pacific Time (America/Los_Angeles)</option>
                                </select>
                            </div>
                        </div>

                        <div class="flex justify-end gap-4 mt-6">
                            <button type="button" onclick="location.reload()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg">
                                Cancel
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Signature Tab -->
                <div id="tab-signature" class="tab-content hidden">
                    <h2 class="text-2xl font-semibold mb-6">Digital Signature</h2>
                    
                    {% if signature_url %}
                    <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                        <p class="text-sm text-green-800 mb-4">
                            <i class="fas fa-check-circle mr-2"></i>You have a signature on file
                        </p>
                        <div class="border border-gray-300 rounded-lg p-4 bg-white inline-block">
                            <img src="{{ signature_url }}" alt="Your Signature" class="max-w-xs max-h-24">
                        </div>
                        <div class="mt-4">
                            <button onclick="deleteSignature()" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg">
                                <i class="fas fa-trash mr-2"></i>Delete Signature
                            </button>
                        </div>
                    </div>
                    {% endif %}

                    <div class="border border-gray-200 rounded-lg p-6">
                        <h3 class="text-lg font-semibold mb-4">Upload New Signature</h3>
                        <form method="post" action="{% url 'admin_user_settings' %}" enctype="multipart/form-data" id="signatureForm">
                            {% csrf_token %}
                            <input type="hidden" name="tab" value="signature">
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Signature Image</label>
                                <input type="file" name="signature" accept="image/*" required
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <p class="text-xs text-gray-500 mt-1">Upload a PNG, JPG, or GIF image of your signature</p>
                            </div>

                            <div class="flex justify-end">
                                <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
                                    <i class="fas fa-upload mr-2"></i>Upload Signature
                                </button>
                            </div>
                        </form>

                        <div class="mt-6 pt-6 border-t border-gray-200">
                            <h4 class="text-md font-semibold mb-3">Type Your Signature</h4>
                            <form method="post" action="{% url 'admin_user_settings' %}" id="typeSignatureForm">
                                {% csrf_token %}
                                <input type="hidden" name="tab" value="signature">
                                <input type="hidden" name="signature_type" value="typed">
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Enter Your Name</label>
                                    <input type="text" name="typed_name" placeholder="e.g., John Smith" maxlength="50"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Choose Font Style</label>
                                    <select name="signature_font" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="Dancing Script">Dancing Script</option>
                                        <option value="Great Vibes">Great Vibes</option>
                                        <option value="Allura">Allura</option>
                                        <option value="Pacifico">Pacifico</option>
                                        <option value="Satisfy">Satisfy</option>
                                    </select>
                                </div>
                                <div class="flex justify-end">
                                    <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
                                        <i class="fas fa-font mr-2"></i>Generate Signature
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Appearance Tab -->
                <div id="tab-appearance" class="tab-content hidden">
                    <h2 class="text-2xl font-semibold mb-6">Appearance & Theme</h2>
                    <form method="post" action="{% url 'admin_user_settings' %}" id="themeForm">
                        {% csrf_token %}
                        <input type="hidden" name="tab" value="appearance">
                        
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-4">Select Theme</label>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <label class="theme-option cursor-pointer">
                                        <input type="radio" name="theme" value="default" {% if theme == 'default' or not theme %}checked{% endif %} class="sr-only peer">
                                        <div class="p-4 border-2 border-gray-200 rounded-lg peer-checked:border-blue-600 peer-checked:bg-blue-50">
                                            <div class="h-16 bg-gradient-to-r from-blue-500 to-blue-600 rounded mb-3"></div>
                                            <div class="font-semibold">Default</div>
                                            <div class="text-sm text-gray-500">Clean and professional</div>
                                        </div>
                                    </label>
                                    <label class="theme-option cursor-pointer">
                                        <input type="radio" name="theme" value="dark" {% if theme == 'dark' %}checked{% endif %} class="sr-only peer">
                                        <div class="p-4 border-2 border-gray-200 rounded-lg peer-checked:border-blue-600 peer-checked:bg-blue-50">
                                            <div class="h-16 bg-gradient-to-r from-gray-800 to-gray-900 rounded mb-3"></div>
                                            <div class="font-semibold">Dark</div>
                                            <div class="text-sm text-gray-500">Easy on the eyes</div>
                                        </div>
                                    </label>
                                    <label class="theme-option cursor-pointer">
                                        <input type="radio" name="theme" value="light" {% if theme == 'light' %}checked{% endif %} class="sr-only peer">
                                        <div class="p-4 border-2 border-gray-200 rounded-lg peer-checked:border-blue-600 peer-checked:bg-blue-50">
                                            <div class="h-16 bg-gradient-to-r from-gray-100 to-gray-200 rounded mb-3"></div>
                                            <div class="font-semibold">Light</div>
                                            <div class="text-sm text-gray-500">Bright and clean</div>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div class="flex justify-end">
                                <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
                                    Save Theme
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.tab-link {
    color: #6b7280;
    transition: all 0.2s;
}
.tab-link:hover {
    background-color: #f3f4f6;
    color: #374151;
}
.tab-link.active {
    background-color: #3b82f6;
    color: white;
}
.tab-content {
    display: block;
}
.tab-content.hidden {
    display: none;
}
.theme-option input:checked + div {
    border-color: #2563eb;
    background-color: #eff6ff;
}
</style>

<script>
function showTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
    });
    
    // Remove active class from all links
    document.querySelectorAll('.tab-link').forEach(link => {
        link.classList.remove('active');
    });
    
    // Show selected tab
    document.getElementById('tab-' + tabName).classList.remove('hidden');
    
    // Add active class to clicked link
    event.target.closest('.tab-link').classList.add('active');
}

// Handle form submissions
document.getElementById('profileForm')?.addEventListener('submit', function(e) {
    e.preventDefault();
    // TODO: Implement API call
    showToast('Profile updated successfully', 'success');
});

document.getElementById('signatureForm')?.addEventListener('submit', function(e) {
    e.preventDefault();
    // TODO: Implement file upload
    showToast('Signature uploaded successfully', 'success');
});

document.getElementById('typeSignatureForm')?.addEventListener('submit', function(e) {
    e.preventDefault();
    // TODO: Implement typed signature generation
    showToast('Signature generated successfully', 'success');
});

document.getElementById('themeForm')?.addEventListener('submit', function(e) {
    e.preventDefault();
    // TODO: Implement theme update
    showToast('Theme updated successfully', 'success');
});

function deleteSignature() {
    if (confirm('Are you sure you want to delete your signature?')) {
        // TODO: Implement delete API call
        showToast('Signature deleted', 'success');
        setTimeout(() => location.reload(), 1000);
    }
}
</script>
{% endblock %}
